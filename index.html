<!DOCTYPE html>
<html>
  <head>
    <script src="libs/react.js"></script>
    <script src="libs/lodash.js"></script>    
    <script src="data/css-selectors.js"></script>
    <style>
      body { font-family: monospace;}
      .active {font-weight: bold;}
    </style>
  </head>
  <body>
    <div id="selectors"></div>
    <script>
      var elSelectors = React.createClass({
          getInitialState: function () {
              return { filter: window.location.hash.slice(1) };
          },
          reFilter: function (e) {
              var str = e.target.innerText;

              str = str === this.state.filter ? '' : str;
              this.setState({ filter: str });
              setHash(str);
          },
          render: function() {
              var filter = this.state.filter;

              return React.DOM.div({onClick: this.reFilter}, 
                  _.chain(selectors)
                  .map(function(v, k) {
                      return v && (!filter || k.indexOf(filter) > -1) ? [k, v] : false;
                  }, {})
                  .compact()
                  .reduce(function(acc, p) {
                      acc[p[0]] = React.createElement(elSelector, {selector: p[0], filter: filter});
                      return acc;
                  }, {})
                  .value()
              );
          }
        }), 

        elSelector = React.createClass({
          render: function() {
              var filter = this.props.filter,
                  spans = this.props.selector.split(' ');
 
              return React.DOM.div({}, 
                _.reduce(spans, function(acc, k) {
                  acc[k] = React.createElement(elPart, {part: k, filter: filter});
                  acc[k+'_'] = React.DOM.text({}, ' ');
                  return acc;
                }, {})
              );
          }
        }),

        elPart = React.createClass({
          render: function() {
            var attribs = {};

            if (this.props.part === this.props.filter) {
                attribs.className = 'active';
            }
            return React.DOM.span(attribs, this.props.part);
          }
        });


      function setHash(str) {
         window.location.hash = str;
      }

      React.render(
        React.createElement(elSelectors),
        document.getElementById('selectors')
      );
    </script>
  </body>
</html>